<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a472a">
  <title>Dice Baseball</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.svg">
  <link rel="icon" type="image/svg+xml" href="icon-192.svg">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
      min-height: 100vh;
      color: white;
      overflow-x: hidden;
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
      padding: 12px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      text-align: center;
      padding: 8px 0;
    }

    h1 {
      font-size: 1.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .scoreboard {
      background: linear-gradient(180deg, #2c2c2c 0%, #1a1a1a 100%);
      border-radius: 12px;
      padding: 12px;
      margin: 8px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .teams {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 8px;
    }

    .team {
      text-align: center;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .team.active {
      background: rgba(255,215,0,0.2);
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
    }

    .team-name {
      font-size: 0.85rem;
      color: #aaa;
      margin-bottom: 4px;
    }

    .team-score {
      font-size: 2.5rem;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .vs {
      font-size: 1rem;
      color: #666;
    }

    .game-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #333;
    }

    .info-item {
      text-align: center;
    }

    .info-label {
      font-size: 0.7rem;
      color: #888;
      text-transform: uppercase;
    }

    .info-value {
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
    }

    .outs-display {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-top: 4px;
    }

    .out-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #333;
      border: 2px solid #555;
    }

    .out-dot.active {
      background: #ff4444;
      border-color: #ff6666;
      box-shadow: 0 0 8px rgba(255,68,68,0.5);
    }

    .diamond-container {
      position: relative;
      width: 100%;
      max-width: 280px;
      margin: 12px auto;
      aspect-ratio: 1;
    }

    .diamond {
      position: absolute;
      width: 70%;
      height: 70%;
      top: 5%;
      left: 15%;
      transform: rotate(45deg);
      border: 3px solid rgba(255,255,255,0.3);
      background: rgba(139,69,19,0.3);
    }

    .base {
      position: absolute;
      width: 32px;
      height: 32px;
      background: #f5f5dc;
      transform: rotate(-45deg);
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .base.occupied {
      background: #ffd700;
      box-shadow: 0 0 15px rgba(255,215,0,0.6);
    }

    .base-home {
      bottom: 0;
      left: 50%;
      transform: translateX(-50%) rotate(45deg);
      border-radius: 0 0 4px 4px;
    }

    .base-first {
      right: 0;
      top: 50%;
      transform: translateY(-50%);
    }

    .base-second {
      top: 0;
      left: 50%;
      transform: translateX(-50%);
    }

    .base-third {
      left: 0;
      top: 50%;
      transform: translateY(-50%);
    }

    .runner-icon {
      font-size: 18px;
      display: none;
    }

    .base.occupied .runner-icon {
      display: block;
    }

    .dice-area {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 12px 0;
    }

    .die {
      width: 60px;
      height: 60px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      color: #333;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      transition: transform 0.1s;
    }

    .die.rolling {
      animation: shake 0.1s infinite;
    }

    @keyframes shake {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .result-display {
      text-align: center;
      padding: 12px;
      min-height: 70px;
    }

    .result-text {
      font-size: 1.4rem;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-hit { color: #4ade80; }
    .result-out { color: #f87171; }
    .result-walk { color: #60a5fa; }
    .result-hr { color: #fbbf24; font-size: 1.6rem; }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: auto;
      padding-bottom: 20px;
    }

    .roll-btn {
      background: linear-gradient(180deg, #dc2626 0%, #991b1b 100%);
      color: white;
      border: none;
      padding: 18px 32px;
      font-size: 1.3rem;
      font-weight: bold;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.2s;
      width: 100%;
    }

    .roll-btn:active {
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    .roll-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }

    .secondary-controls {
      display: flex;
      gap: 10px;
    }

    .secondary-btn {
      flex: 1;
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 12px;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
    }

    .secondary-btn:active {
      background: rgba(255,255,255,0.2);
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
      padding: 24px;
      border-radius: 16px;
      text-align: center;
      max-width: 320px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }

    .modal h2 {
      font-size: 1.8rem;
      margin-bottom: 16px;
      color: #ffd700;
    }

    .modal p {
      margin-bottom: 8px;
      font-size: 1.1rem;
    }

    .winner-text {
      font-size: 1.4rem;
      font-weight: bold;
      margin: 16px 0;
      color: #4ade80;
    }

    .final-score {
      font-size: 2rem;
      font-weight: bold;
      color: #ffd700;
      margin: 12px 0;
    }

    .modal-btn {
      background: linear-gradient(180deg, #dc2626 0%, #991b1b 100%);
      color: white;
      border: none;
      padding: 14px 32px;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 16px;
      width: 100%;
    }

    .innings-detail {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 8px;
      margin: 8px 0;
      font-size: 0.75rem;
      display: grid;
      grid-template-columns: auto repeat(9, 1fr) auto;
      gap: 2px;
    }

    .innings-detail span {
      padding: 4px 2px;
      text-align: center;
    }

    .innings-detail .label {
      color: #888;
      font-weight: bold;
    }

    .innings-detail .current {
      background: rgba(255,215,0,0.3);
      border-radius: 4px;
    }

    .rules-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 1.1rem;
      cursor: pointer;
    }

    .rules-modal .modal-content {
      text-align: left;
      max-width: 360px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .rules-modal h2 {
      text-align: center;
    }

    .rules-list {
      list-style: none;
      margin: 12px 0;
    }

    .rules-list li {
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
    }

    .rules-list .roll {
      color: #ffd700;
      font-weight: bold;
    }

    .rules-list .hit { color: #4ade80; }
    .rules-list .out { color: #f87171; }
    .rules-list .walk { color: #60a5fa; }
    .rules-list .hr { color: #fbbf24; }
  </style>
</head>
<body>
  <div class="container">
    <button class="rules-btn" onclick="showRules()">?</button>

    <header>
      <h1>Dice Baseball</h1>
    </header>

    <div class="scoreboard">
      <div class="teams">
        <div class="team" id="team1">
          <div class="team-name">VISITOR</div>
          <div class="team-score" id="score1">0</div>
        </div>
        <div class="vs">VS</div>
        <div class="team" id="team2">
          <div class="team-name">HOME</div>
          <div class="team-score" id="score2">0</div>
        </div>
      </div>

      <div class="game-info">
        <div class="info-item">
          <div class="info-label">Inning</div>
          <div class="info-value"><span id="inning">1</span><span id="half-inning">st</span></div>
        </div>
        <div class="info-item">
          <div class="info-label">Outs</div>
          <div class="outs-display">
            <div class="out-dot" id="out1"></div>
            <div class="out-dot" id="out2"></div>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">At Bat</div>
          <div class="info-value" id="at-bat">Visitor</div>
        </div>
      </div>

      <div class="innings-detail" id="innings-grid">
        <span class="label"></span>
        <span class="label">1</span>
        <span class="label">2</span>
        <span class="label">3</span>
        <span class="label">4</span>
        <span class="label">5</span>
        <span class="label">6</span>
        <span class="label">7</span>
        <span class="label">8</span>
        <span class="label">9</span>
        <span class="label">R</span>
        <span class="label">VIS</span>
        <span id="v1">-</span>
        <span id="v2">-</span>
        <span id="v3">-</span>
        <span id="v4">-</span>
        <span id="v5">-</span>
        <span id="v6">-</span>
        <span id="v7">-</span>
        <span id="v8">-</span>
        <span id="v9">-</span>
        <span id="vr">0</span>
        <span class="label">HOM</span>
        <span id="h1">-</span>
        <span id="h2">-</span>
        <span id="h3">-</span>
        <span id="h4">-</span>
        <span id="h5">-</span>
        <span id="h6">-</span>
        <span id="h7">-</span>
        <span id="h8">-</span>
        <span id="h9">-</span>
        <span id="hr">0</span>
      </div>
    </div>

    <div class="diamond-container">
      <div class="diamond"></div>
      <div class="base base-home">
        <span class="runner-icon"></span>
      </div>
      <div class="base base-first" id="first-base">
        <span class="runner-icon"></span>
      </div>
      <div class="base base-second" id="second-base">
        <span class="runner-icon"></span>
      </div>
      <div class="base base-third" id="third-base">
        <span class="runner-icon"></span>
      </div>
    </div>

    <div class="dice-area">
      <div class="die" id="die1">?</div>
      <div class="die" id="die2">?</div>
    </div>

    <div class="result-display">
      <div class="result-text" id="result">Tap Roll to play!</div>
    </div>

    <div class="controls">
      <button class="roll-btn" id="roll-btn" onclick="rollDice()">Roll!</button>
      <div class="secondary-controls">
        <button class="secondary-btn" onclick="newGame()">New Game</button>
        <button class="secondary-btn" onclick="showRules()">Rules</button>
      </div>
    </div>
  </div>

  <div class="modal" id="game-over-modal">
    <div class="modal-content">
      <h2>Game Over!</h2>
      <div class="final-score" id="final-score">0 - 0</div>
      <div class="winner-text" id="winner-text">Tie Game!</div>
      <button class="modal-btn" onclick="newGame()">Play Again</button>
    </div>
  </div>

  <div class="modal rules-modal" id="rules-modal">
    <div class="modal-content">
      <h2>How to Play</h2>
      <p>Roll two dice. The total determines the result:</p>
      <ul class="rules-list">
        <li><span class="roll">2</span><span class="hr">HOME RUN!</span></li>
        <li><span class="roll">3</span><span class="hit">Triple</span></li>
        <li><span class="roll">4</span><span class="walk">Walk</span></li>
        <li><span class="roll">5</span><span class="hit">Single</span></li>
        <li><span class="roll">6</span><span class="out">Ground Out</span></li>
        <li><span class="roll">7</span><span class="out">Fly Out</span></li>
        <li><span class="roll">8</span><span class="out">Ground Out</span></li>
        <li><span class="roll">9</span><span class="hit">Single</span></li>
        <li><span class="roll">10</span><span class="hit">Double</span></li>
        <li><span class="roll">11</span><span class="out">Strikeout</span></li>
        <li><span class="roll">12</span><span class="hr">HOME RUN!</span></li>
      </ul>
      <p><strong>Runners advance:</strong></p>
      <p>Single = 1 base, Double = 2, Triple = 3, HR = all score!</p>
      <p style="margin-top:12px;"><strong>9 innings, 3 outs per half-inning.</strong></p>
      <button class="modal-btn" onclick="hideRules()">Got it!</button>
    </div>
  </div>

  <script>
    // Game State
    let game = {
      inning: 1,
      isTopOfInning: true, // true = visitor batting
      outs: 0,
      scores: [0, 0], // [visitor, home]
      inningScores: [
        [null, null, null, null, null, null, null, null, null],
        [null, null, null, null, null, null, null, null, null]
      ],
      bases: [false, false, false], // [1st, 2nd, 3rd]
      isRolling: false,
      gameOver: false
    };

    // Dice results chart
    const results = {
      2: { text: 'HOME RUN!', type: 'hr', bases: 4 },
      3: { text: 'Triple!', type: 'hit', bases: 3 },
      4: { text: 'Walk', type: 'walk', bases: 1 },
      5: { text: 'Single', type: 'hit', bases: 1 },
      6: { text: 'Ground Out', type: 'out', bases: 0 },
      7: { text: 'Fly Out', type: 'out', bases: 0 },
      8: { text: 'Ground Out', type: 'out', bases: 0 },
      9: { text: 'Single', type: 'hit', bases: 1 },
      10: { text: 'Double!', type: 'hit', bases: 2 },
      11: { text: 'Strikeout!', type: 'out', bases: 0 },
      12: { text: 'HOME RUN!', type: 'hr', bases: 4 }
    };

    function rollDice() {
      if (game.isRolling || game.gameOver) return;

      game.isRolling = true;
      const rollBtn = document.getElementById('roll-btn');
      rollBtn.disabled = true;

      const die1 = document.getElementById('die1');
      const die2 = document.getElementById('die2');

      die1.classList.add('rolling');
      die2.classList.add('rolling');

      // Animate dice
      let rolls = 0;
      const rollInterval = setInterval(() => {
        die1.textContent = Math.floor(Math.random() * 6) + 1;
        die2.textContent = Math.floor(Math.random() * 6) + 1;
        rolls++;

        if (rolls >= 10) {
          clearInterval(rollInterval);

          // Final roll
          const d1 = Math.floor(Math.random() * 6) + 1;
          const d2 = Math.floor(Math.random() * 6) + 1;
          die1.textContent = d1;
          die2.textContent = d2;
          die1.classList.remove('rolling');
          die2.classList.remove('rolling');

          // Process result
          const total = d1 + d2;
          processResult(total);

          game.isRolling = false;
          rollBtn.disabled = false;
        }
      }, 80);
    }

    function processResult(total) {
      const result = results[total];
      const resultEl = document.getElementById('result');

      // Display result
      resultEl.className = 'result-text';
      if (result.type === 'hr') resultEl.classList.add('result-hr');
      else if (result.type === 'hit') resultEl.classList.add('result-hit');
      else if (result.type === 'walk') resultEl.classList.add('result-walk');
      else resultEl.classList.add('result-out');

      resultEl.textContent = result.text;

      // Trigger animation
      resultEl.style.animation = 'none';
      resultEl.offsetHeight; // Trigger reflow
      resultEl.style.animation = '';

      // Process game logic
      if (result.type === 'out') {
        game.outs++;
        if (game.outs >= 3) {
          endHalfInning();
        }
      } else if (result.type === 'hr') {
        // Score all runners + batter
        let runs = 1; // batter
        runs += game.bases.filter(b => b).length;
        game.scores[game.isTopOfInning ? 0 : 1] += runs;
        game.bases = [false, false, false];
      } else if (result.type === 'walk') {
        // Advance runners only if forced
        if (game.bases[0]) {
          if (game.bases[1]) {
            if (game.bases[2]) {
              // Bases loaded - run scores
              game.scores[game.isTopOfInning ? 0 : 1]++;
            }
            game.bases[2] = true;
          }
          game.bases[1] = true;
        }
        game.bases[0] = true;
      } else if (result.type === 'hit') {
        advanceRunners(result.bases);
      }

      updateDisplay();
    }

    function advanceRunners(basesToAdvance) {
      let runs = 0;

      // Move runners (start from 3rd base going back)
      for (let i = 2; i >= 0; i--) {
        if (game.bases[i]) {
          game.bases[i] = false;
          const newBase = i + basesToAdvance;
          if (newBase >= 3) {
            runs++;
          } else {
            game.bases[newBase] = true;
          }
        }
      }

      // Place batter
      if (basesToAdvance >= 4) {
        runs++;
      } else {
        game.bases[basesToAdvance - 1] = true;
      }

      game.scores[game.isTopOfInning ? 0 : 1] += runs;
    }

    function endHalfInning() {
      const teamIdx = game.isTopOfInning ? 0 : 1;
      const inningIdx = game.inning - 1;

      // Calculate runs this half-inning
      const prevTotal = game.inningScores[teamIdx].slice(0, inningIdx).reduce((a, b) => (a || 0) + (b || 0), 0);
      const currentRuns = game.scores[teamIdx] - prevTotal;
      game.inningScores[teamIdx][inningIdx] = currentRuns;

      // Clear bases
      game.bases = [false, false, false];
      game.outs = 0;

      if (game.isTopOfInning) {
        game.isTopOfInning = false;

        // Check for walk-off possibility in 9th
        if (game.inning >= 9 && game.scores[1] > game.scores[0]) {
          endGame();
          return;
        }
      } else {
        // End of full inning
        // Calculate home team's runs this inning
        const homePrevTotal = game.inningScores[1].slice(0, inningIdx).reduce((a, b) => (a || 0) + (b || 0), 0);
        const homeCurrentRuns = game.scores[1] - homePrevTotal;
        game.inningScores[1][inningIdx] = homeCurrentRuns;

        if (game.inning >= 9) {
          if (game.scores[0] !== game.scores[1]) {
            endGame();
            return;
          }
          // Tie - extra innings!
        }
        game.inning++;
        game.isTopOfInning = true;
      }

      updateDisplay();
    }

    function endGame() {
      game.gameOver = true;

      const modal = document.getElementById('game-over-modal');
      const finalScore = document.getElementById('final-score');
      const winnerText = document.getElementById('winner-text');

      finalScore.textContent = `${game.scores[0]} - ${game.scores[1]}`;

      if (game.scores[0] > game.scores[1]) {
        winnerText.textContent = 'Visitor Wins!';
      } else if (game.scores[1] > game.scores[0]) {
        winnerText.textContent = 'Home Wins!';
      } else {
        winnerText.textContent = "It's a Tie!";
      }

      modal.classList.add('show');
    }

    function updateDisplay() {
      // Scores
      document.getElementById('score1').textContent = game.scores[0];
      document.getElementById('score2').textContent = game.scores[1];

      // Team highlighting
      document.getElementById('team1').classList.toggle('active', game.isTopOfInning);
      document.getElementById('team2').classList.toggle('active', !game.isTopOfInning);

      // Inning
      document.getElementById('inning').textContent = game.inning;
      const suffix = game.isTopOfInning ? ' TOP' : ' BOT';
      document.getElementById('half-inning').textContent = suffix;

      // At bat
      document.getElementById('at-bat').textContent = game.isTopOfInning ? 'Visitor' : 'Home';

      // Outs
      document.getElementById('out1').classList.toggle('active', game.outs >= 1);
      document.getElementById('out2').classList.toggle('active', game.outs >= 2);

      // Bases
      document.getElementById('first-base').classList.toggle('occupied', game.bases[0]);
      document.getElementById('second-base').classList.toggle('occupied', game.bases[1]);
      document.getElementById('third-base').classList.toggle('occupied', game.bases[2]);

      // Innings grid
      for (let i = 1; i <= 9; i++) {
        const vCell = document.getElementById('v' + i);
        const hCell = document.getElementById('h' + i);

        vCell.textContent = game.inningScores[0][i-1] !== null ? game.inningScores[0][i-1] : '-';
        hCell.textContent = game.inningScores[1][i-1] !== null ? game.inningScores[1][i-1] : '-';

        // Highlight current inning
        vCell.classList.toggle('current', i === game.inning && game.isTopOfInning);
        hCell.classList.toggle('current', i === game.inning && !game.isTopOfInning);
      }

      document.getElementById('vr').textContent = game.scores[0];
      document.getElementById('hr').textContent = game.scores[1];
    }

    function newGame() {
      game = {
        inning: 1,
        isTopOfInning: true,
        outs: 0,
        scores: [0, 0],
        inningScores: [
          [null, null, null, null, null, null, null, null, null],
          [null, null, null, null, null, null, null, null, null]
        ],
        bases: [false, false, false],
        isRolling: false,
        gameOver: false
      };

      document.getElementById('game-over-modal').classList.remove('show');
      document.getElementById('die1').textContent = '?';
      document.getElementById('die2').textContent = '?';
      document.getElementById('result').textContent = 'Tap Roll to play!';
      document.getElementById('result').className = 'result-text';

      updateDisplay();
    }

    function showRules() {
      document.getElementById('rules-modal').classList.add('show');
    }

    function hideRules() {
      document.getElementById('rules-modal').classList.remove('show');
    }

    // Initialize
    updateDisplay();

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(err => console.log('SW registration failed'));
    }
  </script>
</body>
</html>
